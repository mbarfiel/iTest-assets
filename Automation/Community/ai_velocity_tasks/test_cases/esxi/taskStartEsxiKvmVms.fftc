<?xml version="1.0"?>
<testCase version="7.1.0.201804110601">
    <general>
        <owner>MBarfield</owner>
        <language>Python</language>
    </general>
    <testbed>project://ai_velocity_tasks/topologies/Velocity/KVM_Workshop/KVM_Workshop.tbml</testbed>
    <procedures>
        <item name="main">
            <steps>
                <item guid="a3f5bee5-267d-48b7-9bdd-e824873460b7" action="comment">
                    <command>
                        <body>variables</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="41e47cb1-6203-402d-b00a-11405e134b3b" action="eval">
                    <command>
                        <body>baselineSnapshot = velocity(&apos;property&apos;, &apos;-name&apos;, &apos;KVM_Workshop&apos;, &apos;baselineSnapshot&apos;)</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="49ded818-562f-4fa6-b408-0dabeeba0472" action="eval">
                    <command>
                        <body>vmImageName = velocity(&apos;property&apos;, &apos;-name&apos;, &apos;KVM_Workshop&apos;, &apos;vmImageName&apos;)</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="e8bc7053-dfab-46c6-bf3e-73a000a1087a" action="eval">
                    <command>
                        <body>snapshotId = velocity(&apos;property&apos;, &apos;-name&apos;, &apos;KVM_Workshop&apos;, &apos;snapshotId&apos;)</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="a31783bb-4e60-49ab-a9da-aaa4c52e54c2" action="eval" skip="true">
                    <command>
                        <body>print(vmImageName)</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="83b9b140-f542-4c0c-9c1c-6a7148f1d620" action="eval" skip="true">
                    <command>
                        <body>print(baselineSnapshot)</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="d62cacf1-81c0-4319-8a69-17b714b8610d" action="comment">
                    <command>
                        <body>Open sessions</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="373cd479-5fdf-493a-be33-14de0b670e4d" action="open" session="KVM_Workshop">
                    <command>
                        <body>device:KVM_Workshop#VMware_vSphere_Client</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.OpenStepPropertyGroup">
                        <stepProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        <sessionProperties type="com.fnfr.svt.adapter.automation.tools.common.documents.TransferableDocumentObject" transferableToolId="com.fnfr.itest.applications.vmware.vi.core.tool" transferableType="com.fnfr.itest.applications.vmware.vi.core.VMwareViSessionProperties"/>
                        <sessionClass type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        <sessionVersion type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    </applicationProperties>
                </item>
                <item guid="2d567b57-5918-4fb0-adc3-3298e7893125" action="getVMInfo" session="KVM_Workshop" normalOffset="93.012" estimatedStepExecutionTime="0.173">
                    <command>
                        <body>[vmImageName]</body>
                    </command>
                    <postProcessing>
                        <analysisRules>
                            <item>
                                <extractorInfo extractorType="query">
                                    <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                        <query>(.//vmInfoTable/row/Value)[7]</query>
                                    </extractorProperties>
                                </extractorInfo>
                                <processorInfo ruleType="store">
                                    <ruleProperties type="com.fnfr.svt.execution.builtin.processors.StoreProcessorPropertyGroup">
                                        <storageLocation>vmPwrState</storageLocation>
                                    </ruleProperties>
                                </processorInfo>
                            </item>
                        </analysisRules>
                    </postProcessing>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="a20d00b0-5463-4835-a41f-2f4d58e62aa8" action="if">
                    <command>
                        <body>vmPwrState != &apos;Powered Off&apos;:</body>
                    </command>
                    <nestedSteps>
                        <item guid="59b6187b-5eff-4265-9cf7-626d7d73ba20" action="comment">
                            <command>
                                <body>Power off VM and reset to baseline</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                        <item guid="d21345a4-4d31-482e-9f24-91c64076bcb6" action="powerOffVM" session="KVM_Workshop" normalOffset="41.15" estimatedStepExecutionTime="2.101">
                            <command>
                                <body>[vmImageName]</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                        <item guid="7f8931c5-d4c7-429d-aafa-5d60efe1af68" action="getVMInfo" session="KVM_Workshop" normalOffset="11.37" estimatedStepExecutionTime="0.159">
                            <command>
                                <body>[vmImageName]</body>
                            </command>
                            <postProcessing>
                                <analysisRules>
                                    <item>
                                        <extractorInfo extractorType="query">
                                            <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                                <query>(.//vmInfoTable/row/Value)[7]</query>
                                            </extractorProperties>
                                        </extractorInfo>
                                        <processorInfo ruleType="assert">
                                            <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                                <expression>value == &quot;Powered Off&quot;</expression>
                                                <actionsWhenTrue>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="OK">
                                                            <message>Verify that VM is Powered Off</message>
                                                        </actionProperties>
                                                    </item>
                                                    <item actionId="PassTestIfNotAlreadyFailed">
                                                        <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                                    </item>
                                                </actionsWhenTrue>
                                                <actionsWhenFalse>
                                                    <item actionId="DeclareExecutionIssue">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                                            <message>Verify that VM is powered off</message>
                                                        </actionProperties>
                                                    </item>
                                                    <item actionId="RepeatStep">
                                                        <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup" delayBetweenRepeats="5.0"/>
                                                    </item>
                                                </actionsWhenFalse>
                                            </ruleProperties>
                                        </processorInfo>
                                    </item>
                                </analysisRules>
                            </postProcessing>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="99c3cd0f-b340-4126-94ad-c4ac06f1d2a2" action="else">
                    <nestedSteps>
                        <item guid="f91aefbb-a11e-4d4e-925a-ae4f122ed92e" action="comment">
                            <command>
                                <body>Insert steps here for when the expression evaluates to false</body>
                            </command>
                            <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                            <useFieldsInCommand>false</useFieldsInCommand>
                        </item>
                    </nestedSteps>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                    <useFieldsInCommand>false</useFieldsInCommand>
                </item>
                <item guid="a3fedf20-16db-46b6-bbbd-4af60f4090e6" action="comment">
                    <command>
                        <body>Verify Powered Off before moving forward</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="ff505fda-c1f3-43d8-805c-89889a3c894f" action="comment">
                    <command>
                        <body>Restore snapshot</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="fac55d96-ba48-49d6-ab75-8d2b7e4d7760" action="revertSnapshot" session="KVM_Workshop" normalOffset="240.971" estimatedStepExecutionTime="9.299">
                    <command>
                        <body>[vmImageName]</body>
                    </command>
                    <postProcessing>
                        <analysisRules>
                            <item>
                                <extractorInfo extractorType="query">
                                    <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                        <query>result()</query>
                                    </extractorProperties>
                                </extractorInfo>
                                <processorInfo ruleType="assert">
                                    <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                        <expression>value == &quot;success&quot;</expression>
                                        <actionsWhenTrue>
                                            <item actionId="DeclareExecutionIssue">
                                                <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="OK">
                                                    <message>Baseline snapshot restored</message>
                                                </actionProperties>
                                            </item>
                                            <item actionId="PassTestIfNotAlreadyFailed">
                                                <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                            </item>
                                        </actionsWhenTrue>
                                        <actionsWhenFalse>
                                            <item actionId="DeclareExecutionIssue">
                                                <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup">
                                                    <message>{auto_message_false}</message>
                                                </actionProperties>
                                            </item>
                                            <item actionId="FailTest">
                                                <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                            </item>
                                        </actionsWhenFalse>
                                    </ruleProperties>
                                </processorInfo>
                            </item>
                        </analysisRules>
                    </postProcessing>
                    <applicationProperties type="com.fnfr.svt.adapter.automation.tools.common.documents.TransferableDocumentObject" transferableToolId="com.fnfr.itest.applications.vmware.vi.core.tool" transferableType="com.fnfr.itest.applications.vmware.vi.core.properties.SnapshotIDProperties" snapshotID="[snapshotId]" snapshotID.inherit="false"/>
                </item>
                <item guid="fd92abe5-007e-40fd-9bda-f29c2db69bb8" action="getVMInfo" session="KVM_Workshop" skip="true">
                    <command>
                        <body>[vmImageName]</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="7804bc0f-2eaa-4efe-a88f-49b99c287ae1" action="sleep" skip="true">
                    <command>
                        <body>20</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="ca71f7d3-234a-468d-b02f-b2050364c0d8" action="getVMInfo" session="KVM_Workshop" skip="true">
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="138d43c4-f9e7-4ab0-a0f2-88094e8eb5f5" action="comment">
                    <command>
                        <body>Power on VM</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="a045e5ab-15bd-418e-a178-f2096a5dffa3" action="powerOnVM" session="KVM_Workshop" normalOffset="41.15" estimatedStepExecutionTime="2.101">
                    <command>
                        <body>[vmImageName]</body>
                    </command>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="3a8cd6c4-4a64-4144-963b-230843d47066" action="getVMInfo" session="KVM_Workshop" normalOffset="97.209" estimatedStepExecutionTime="0.173">
                    <command>
                        <body>[vmImageName]</body>
                    </command>
                    <postProcessing>
                        <analysisRules>
                            <item>
                                <extractorInfo extractorType="query">
                                    <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                        <query>(.//vmInfoTable/row/Value)[7]</query>
                                    </extractorProperties>
                                </extractorInfo>
                                <processorInfo ruleType="assert">
                                    <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                        <expression>value == &quot;Powered On&quot;</expression>
                                        <actionsWhenTrue>
                                            <item actionId="DeclareExecutionIssue">
                                                <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="OK">
                                                    <message>{auto_message_true}</message>
                                                </actionProperties>
                                            </item>
                                            <item actionId="PassTestIfNotAlreadyFailed">
                                                <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                            </item>
                                        </actionsWhenTrue>
                                        <actionsWhenFalse>
                                            <item actionId="DeclareExecutionIssue">
                                                <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                                    <message>Keeping checking power state</message>
                                                </actionProperties>
                                            </item>
                                            <item actionId="RepeatStep">
                                                <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup" maxRepeatCount="20" delayBetweenRepeats="5.0"/>
                                            </item>
                                        </actionsWhenFalse>
                                    </ruleProperties>
                                </processorInfo>
                            </item>
                        </analysisRules>
                    </postProcessing>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="dad1aca5-0730-4be3-8a62-61bed678f076" action="getVMInfo" session="KVM_Workshop" normalOffset="97.209" estimatedStepExecutionTime="0.173">
                    <command>
                        <body>[vmImageName]</body>
                    </command>
                    <postProcessing>
                        <analysisRules>
                            <item>
                                <extractorInfo extractorType="query">
                                    <extractorProperties type="com.fnfr.svt.mapping.execution.extractors.QueryDataExtractorPropertyGroup">
                                        <query>(.//vmInfoTable/row/Value)[10]</query>
                                    </extractorProperties>
                                </extractorInfo>
                                <processorInfo ruleType="assert">
                                    <ruleProperties type="com.fnfr.svt.execution.builtin.processors.AssertionPropertyGroup">
                                        <expression>value == &quot;OK&quot;</expression>
                                        <actionsWhenTrue>
                                            <item actionId="DeclareExecutionIssue">
                                                <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="OK">
                                                    <message>{auto_message_true}</message>
                                                </actionProperties>
                                            </item>
                                            <item actionId="PassTestIfNotAlreadyFailed">
                                                <actionProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                                            </item>
                                        </actionsWhenTrue>
                                        <actionsWhenFalse>
                                            <item actionId="DeclareExecutionIssue">
                                                <actionProperties type="com.fnfr.svt.execution.builtin.actions.ExecutionIssuePropertyGroup" severity="Information">
                                                    <message>Keeping checking VM status OK, actual status [value]</message>
                                                </actionProperties>
                                            </item>
                                            <item actionId="RepeatStep">
                                                <actionProperties type="com.fnfr.svt.execution.builtin.actions.RepeatStepPropertyGroup" maxRepeatCount="60" delayBetweenRepeats="10.0"/>
                                            </item>
                                        </actionsWhenFalse>
                                    </ruleProperties>
                                </processorInfo>
                            </item>
                        </analysisRules>
                    </postProcessing>
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
                <item guid="7a55b8ca-0881-4a04-a9bd-c1540f15f2ec" action="close" session="KVM_Workshop" normalOffset="70.882">
                    <applicationProperties type="com.fnfr.svt.documents.EmptyPropertyGroup"/>
                </item>
            </steps>
        </item>
    </procedures>
</testCase>
